<!DOCTYPE html>
<html lang="en">
	<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta
		http-equiv="Content-Security-Policy"
		content="default-src *;
   img-src * 'self' data: https:; script-src 'self' 'unsafe-inline' 'unsafe-eval' *;
   style-src  'self' 'unsafe-inline' *"
	/>
	<title>Document</title>
	<link
		rel="stylesheet"
		href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
		integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn"
		crossorigin="anonymous"
	/>

	<link
		rel="stylesheet"
		href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css"
		integrity="sha512-YWzhKL2whUzgiheMoBFwW8CKV4qpHQAEuvilg9FAn5VJUDwKZZxkJNuGM4XkWuk94WCrrwslk8yWNGmY1EduTA=="
		crossorigin="anonymous"
		referrerpolicy="no-referrer"
	/>
	<link
		rel="stylesheet"
		href="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.css"
	/>
	<body>
		<main class="container" style="margin-top: 5vh">
			<div class="shadow p-3 mb-5 bg-body rounded">
				<form id="createEntry">
					<div class="row">
						<div class="col">
							<label for="link" class="form-label">Record Link</label>
							<input type="text" class="form-control" name="link" id="link" placeholder="Link" />
						</div>
						<div class="col">
							<label for="date" class="form-label">Date</label>
							<input type="date" class="form-control" name="date" id="date" />
						</div>
						<div class="col">
							<label for="start" class="form-label">Start Time</label>
							<input type="time" class="form-control" name="start" id="start" />
						</div>
						<div class="col">
							<label for="end" class="form-label">End Time</label>
							<input type="time" class="form-control" name="end" id="end" />
						</div>
					</div>
					<div class="text-center" style="margin-top: 2vh">
						<button class="btn btn-outline-primary btn-lg" type="submit">Add Record</button>
					</div>
				</form>
			</div>
			<table id="table" class="table table-hover"></table>
		</main>
	</body>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
	<script
		src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
		integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
		crossorigin="anonymous"
	></script>
	<script src="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.js"></script>
	<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script src="http://docs.jodu555.de/utils/utils.js"></script>
	<script src="http://docs.jodu555.de/utils/networking.js"></script>

	<script>
		const network = new Networking('http://localhost:3100/');

		const createEntry = document.querySelector('#createEntry');
		createEntry.addEventListener('submit', (e) => {
			e.preventDefault();
			const obj = formDataToObject(new FormData(createEntry));
			console.log(obj);
			network.post('entry', JSON.stringify(obj));
			createEntry.reset();
		});

		(async () => {
			await loadEntrysAndDisplayTable();
		})();

		async function loadEntrysAndDisplayTable(params) {
			const data = await network.get('entry');

			$table = $('#table');

			$table.bootstrapTable('destroy');

			$table.bootstrapTable({
				search: true,
				columns: [
					{
						sortable: true,
						field: 'id',
						title: 'ID',
					},
					{
						field: 'link',
						title: 'Link',
					},
					{
						field: 'time',
						title: 'Date',
					},
					{
						sortable: true,
						field: 'startTime',
						title: 'Start Time',
					},
					{
						sortable: true,
						field: 'endTime',
						title: 'End Time',
					},
					{
						sortable: true,
						field: 'status',
						title: 'Status',
					},
				],
				data,
			});
		}
	</script>
</html>
